<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="../assets/css/light.css" integrity="sha512-ZX/aBpdCBW4Eu5Bjc7USrGeiSiN2UpIuetQ1YMRtplE4MkM78yNQ+KiJYTWqFueppZ1C//BgkiOd+Vvx//iabw==" title="Light" id="stylesheet-light"><link rel="stylesheet" href="../assets/css/dark.css" integrity="sha512-w0U8MAmTKZwYGKoZzBaimTEtI6cRyPxTv78JtkqDmvfjljTGU55Nppb++dx5aDvdhoY6R1UMRQzTOYg0Z9DOoQ==" title="Dark" id="stylesheet-dark" disabled><title>Programming Language Foundations in Agda – Bisimulation</title><script src="../assets/js/anchor.js" integrity="sha512-Y5IMGqYQp36NYYdEL6gXISLsHNpx0LxW0NS0twvYBvXI8GH5PZa1g5gm1B5lxg6tlFyUAiOOfgKL/NIn0dtY4w==" id="script-anchor"></script><script src="../assets/js/darkmode.js" integrity="sha512-iUX9HnSphH4WbMv88MYJEFtLfkCtTHrvWyFwjigSm5GkwHv1L31GP5grIGDo7kI2jftuYVvt4xu4qeCn2fKbww==" id="script-darkmode"></script><script src="../assets/js/main.js" integrity="sha512-X7aZg6IUKq1TvTVjSureaMGKZ/ylbAD7kxiU2w42IUgh4lUTWoOsoIWzNvrqkwBJdQ1y2GsS67gtsv39Uuq6ew==" id="script-main"></script></head><body><header class="site-header"><div class="wrapper"><a class="site-title" href="../">Programming Language Foundations in Agda</a><nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"><label for="nav-trigger"><span class="menu-icon"><svg class="svg-icon grey" viewBox="0 0 18 15" width="18px" height="15px"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path></svg></span></label><div class="trigger"><a class="page-link" href="../">The Book</a> <a class="page-link" href="../Announcements/">Announcements</a> <a class="page-link" href="../GettingStarted/">Getting Started</a> <a class="page-link" href="../Citing/">Citing</a> <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a> <a class="page-link" onclick="window.darkmode.toggle()"><i id="darkmode-trigger" class="fas fa-moon" aria-hidden="true"></i> </a><a class="page-link" href="../plfa.epub"><i class="fa fa-book" aria-hidden="true"></i></a></div></nav></div></header><main class="page-content" aria-label="Content"><div class="wrapper"><article class="post"><nav class="pager"><ul class="pagination"><li><a class="pagelink" href="../More/">Prev</a></li><li class="separator">•</li><li><a class="pagelink" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/part2/Bisimulation.lagda.md">Source</a></li><li class="separator">•</li><li><a class="pagelink" href="../Inference/">Next</a></li><li class="separator">•</li></ul></nav><header class="post-header"><h1 class="post-title">Bisimulation: Relating reduction systems</h1></header><div class="post-content"><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-100" class="Keyword">module</a> <a id="plfa_plfa-part2-Bisimulation-107" href="../Bisimulation/#" class="Module">plfa.part2.Bisimulation</a> <a id="plfa_plfa-part2-Bisimulation-131" class="Keyword">where</a>
</pre><p>Some constructs can be defined in terms of other constructs. In the previous chapter, we saw how <em>let</em> terms can be rewritten as an application of an abstraction, and how two alternative formulations of products — one with projections and one with case — can be formulated in terms of each other. In this chapter, we look at how to formalise such claims.</p><p>Given two different systems, with different terms and reduction rules, we define what it means to claim that one <em>simulates</em> the other. Let’s call our two systems <em>source</em> and <em>target</em>. Let <code>M</code>, <code>N</code> range over terms of the source, and <code>M†</code>, <code>N†</code> range over terms of the target. We define a relation</p><pre><code>M ~ M†</code></pre><p>between corresponding terms of the two systems. We have a <em>simulation</em> of the source by the target if every reduction in the source has a corresponding reduction sequence in the target:</p><p><em>Simulation</em>: For every <code>M</code>, <code>M†</code>, and <code>N</code>: If <code>M ~ M†</code> and <code>M —→ N</code> then <code>M† —↠ N†</code> and <code>N ~ N†</code> for some <code>N†</code>.</p><p>Or, in a diagram:</p><pre><code>M  --- —→ --- N
|             |
|             |
~             ~
|             |
|             |
M† --- —↠ --- N†</code></pre><p>Sometimes we will have a stronger condition, where each reduction in the source corresponds to a reduction (rather than a reduction sequence) in the target:</p><pre><code>M  --- —→ --- N
|             |
|             |
~             ~
|             |
|             |
M† --- —→ --- N†</code></pre><p>This stronger condition is known as <em>lock-step</em> or <em>on the nose</em> simulation.</p><p>We are particularly interested in the situation where there is also a simulation from the target to the source: every reduction in the target has a corresponding reduction sequence in the source. In other words, <code>~</code> is a simulation from source to target, and the converse of <code>~</code> is a simulation from target to source: this situation is called a <em>bisimulation</em>. (In general, if &lt; and &gt; are arbitrary relations such that <code>x &lt; y</code> if and only if <code>y &gt; x</code> then we say that <code>&lt;</code> and <code>&gt;</code> are <em>converse</em> relations. Hence, if <code>~</code> is a relation from source to target, its converse is a relation from target to source.)</p><p>Simulation is established by case analysis over all possible reductions and all possible terms to which they are related. For each reduction step in the source we must show a corresponding reduction sequence in the target.</p><p>For instance, the source might be lambda calculus with <em>let</em> added, and the target the same system with <code>let</code> translated out. The key rule defining our relation will be:</p><pre><code>M ~ M†
N ~ N†
--------------------------------
let x = M in N ~ (ƛ x ⇒ N†) · M†</code></pre><p>All the other rules are congruences: variables relate to themselves, and abstractions and applications relate if their components relate:</p><pre><code>-----
x ~ x

N ~ N†
------------------
ƛ x ⇒ N ~ ƛ x ⇒ N†

L ~ L†
M ~ M†
---------------
L · M ~ L† · M†</code></pre><p>Covering the other constructs of our language — naturals, fixpoints, products, and so on — would add little save length.</p><p>In this case, our relation can be specified by a function from source to target:</p><pre><code>(x) †               =  x
(ƛ x ⇒ N) †         =  ƛ x ⇒ (N †)
(L · M) †           =  (L †) · (M †)
(let x = M in N) †  =  (ƛ x ⇒ (N †)) · (M †)</code></pre><p>And we have</p><pre><code>M † ≡ N
-------
M ~ N</code></pre><p>and conversely. But in general we may have a relation without any corresponding function.</p><p>This chapter formalises establishing that <code>~</code> as defined above is a simulation from source to target. We leave establishing it in the reverse direction as an exercise. Another exercise is to show the alternative formulations of products in Chapter <a href="../More/">More</a> are in bisimulation.</p><h2 id="imports">Imports</h2>We import our source language from Chapter <a href="../More/">More</a>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-3905" class="Keyword">open</a> <a id="plfa_plfa-part2-Bisimulation-3910" class="Keyword">import</a> <a id="plfa_plfa-part2-Bisimulation-3917" href="../More/#" class="Module">plfa.part2.More</a>
</pre><h2 id="simulation">Simulation</h2>The simulation is a straightforward formalisation of the rules in the introduction:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-4046" class="Keyword">infix</a>  <a id="plfa_plfa-part2-Bisimulation-4053" class="Number">4</a> <a id="plfa_plfa-part2-Bisimulation-4055" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">_~_</a>
<a id="plfa_plfa-part2-Bisimulation-4059" class="Keyword">infix</a>  <a id="plfa_plfa-part2-Bisimulation-4066" class="Number">5</a> <a id="plfa_plfa-part2-Bisimulation-4068" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ_</a>
<a id="plfa_plfa-part2-Bisimulation-4072" class="Keyword">infix</a>  <a id="plfa_plfa-part2-Bisimulation-4079" class="Number">7</a> <a id="plfa_plfa-part2-Bisimulation-4081" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">_~·_</a>

<a id="plfa_plfa-part2-Bisimulation-4087" class="Keyword">data</a> <a id="plfa_plfa-part2-Bisimulation-_~_"></a><a id="plfa_plfa-part2-Bisimulation-4092" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">_~_</a> <a id="plfa_plfa-part2-Bisimulation-4096" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4098" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-4100" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4101" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4101" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4103" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4103" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4104" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4106" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4108" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-4109" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4101" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4111" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4113" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4103" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4114" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-4116" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4118" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-4119" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4101" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4121" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4123" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4103" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4124" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-4126" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4128" href="https://agda.github.io/agda-stdlib/v1.7.1/Agda.Primitive.html#326" class="Primitive">Set</a> <a id="plfa_plfa-part2-Bisimulation-4132" class="Keyword">where</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_.~`"></a><a id="plfa_plfa-part2-Bisimulation-4141" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a> <a id="plfa_plfa-part2-Bisimulation-4144" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4146" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-4148" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4149" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4149" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4151" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4151" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4152" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4154" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4155" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4155" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-4157" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4159" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4149" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4161" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-4163" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4151" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4164" class="Symbol">}</a>
     <a id="plfa_plfa-part2-Bisimulation-4171" class="Comment">---------</a>
   <a id="plfa_plfa-part2-Bisimulation-4184" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4186" href="../More/#plfa_plfa-part2-More-15002" class="InductiveConstructor Operator">`</a> <a id="plfa_plfa-part2-Bisimulation-4188" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4155" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-4190" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4192" href="../More/#plfa_plfa-part2-More-15002" class="InductiveConstructor Operator">`</a> <a id="plfa_plfa-part2-Bisimulation-4194" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4155" class="Bound">x</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_.~ƛ_"></a><a id="plfa_plfa-part2-Bisimulation-4199" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ_</a> <a id="plfa_plfa-part2-Bisimulation-4203" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4205" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-4207" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4208" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4208" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4210" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4210" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4212" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4212" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4213" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4215" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4216" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4216" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4218" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4218" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-4221" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4223" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4208" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4225" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-4227" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4210" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4229" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4231" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4212" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4232" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-4238" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4240" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4216" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4242" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4244" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4218" class="Bound">N†</a>
      <a id="plfa_plfa-part2-Bisimulation-4253" class="Comment">----------</a>
    <a id="plfa_plfa-part2-Bisimulation-4268" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4270" href="../More/#plfa_plfa-part2-More-15070" class="InductiveConstructor Operator">ƛ</a> <a id="plfa_plfa-part2-Bisimulation-4272" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4216" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4274" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4276" href="../More/#plfa_plfa-part2-More-15070" class="InductiveConstructor Operator">ƛ</a> <a id="plfa_plfa-part2-Bisimulation-4278" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4218" class="Bound">N†</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_._~·_"></a><a id="plfa_plfa-part2-Bisimulation-4284" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">_~·_</a> <a id="plfa_plfa-part2-Bisimulation-4289" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4291" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-4293" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4294" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4294" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4296" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4296" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4298" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4298" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4299" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4301" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4302" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4302" class="Bound">L</a> <a id="plfa_plfa-part2-Bisimulation-4304" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4304" class="Bound">L†</a> <a id="plfa_plfa-part2-Bisimulation-4307" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4309" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4294" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4311" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4313" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4296" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4315" href="../More/#plfa_plfa-part2-More-14526" class="InductiveConstructor Operator">⇒</a> <a id="plfa_plfa-part2-Bisimulation-4317" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4298" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4318" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4320" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4321" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4321" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4323" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4323" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-4326" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4328" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4294" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4330" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4332" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4296" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4333" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-4339" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4341" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4302" class="Bound">L</a> <a id="plfa_plfa-part2-Bisimulation-4343" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4345" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4304" class="Bound">L†</a>
    <a id="plfa_plfa-part2-Bisimulation-4352" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4354" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4321" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4356" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4358" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4323" class="Bound">M†</a>
      <a id="plfa_plfa-part2-Bisimulation-4367" class="Comment">---------------</a>
    <a id="plfa_plfa-part2-Bisimulation-4387" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4389" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4302" class="Bound">L</a> <a id="plfa_plfa-part2-Bisimulation-4391" href="../More/#plfa_plfa-part2-More-15138" class="InductiveConstructor Operator">·</a> <a id="plfa_plfa-part2-Bisimulation-4393" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4321" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4395" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4397" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4304" class="Bound">L†</a> <a id="plfa_plfa-part2-Bisimulation-4400" href="../More/#plfa_plfa-part2-More-15138" class="InductiveConstructor Operator">·</a> <a id="plfa_plfa-part2-Bisimulation-4402" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4323" class="Bound">M†</a>

  <a id="plfa_plfa-part2-Bisimulation-_~_.~let"></a><a id="plfa_plfa-part2-Bisimulation-4408" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-4413" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4415" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-4417" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4418" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4418" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4420" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4420" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4422" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4422" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4423" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4425" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4426" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4426" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4428" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4428" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-4431" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4433" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4418" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4435" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4437" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4420" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-4438" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-4440" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-4441" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4441" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4443" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4443" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-4446" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-4448" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4418" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-4450" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-4452" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4420" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-4454" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-4456" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4422" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-4457" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-4463" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4465" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4426" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4467" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4469" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4428" class="Bound">M†</a>
    <a id="plfa_plfa-part2-Bisimulation-4476" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4478" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4441" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4480" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4482" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4443" class="Bound">N†</a>
      <a id="plfa_plfa-part2-Bisimulation-4491" class="Comment">----------------------</a>
    <a id="plfa_plfa-part2-Bisimulation-4518" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-4520" href="../More/#plfa_plfa-part2-More-15644" class="InductiveConstructor">`let</a> <a id="plfa_plfa-part2-Bisimulation-4525" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4426" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-4527" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4441" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-4529" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-4531" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-4532" href="../More/#plfa_plfa-part2-More-15070" class="InductiveConstructor Operator">ƛ</a> <a id="plfa_plfa-part2-Bisimulation-4534" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4443" class="Bound">N†</a><a id="plfa_plfa-part2-Bisimulation-4536" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-4538" href="../More/#plfa_plfa-part2-More-15138" class="InductiveConstructor Operator">·</a> <a id="plfa_plfa-part2-Bisimulation-4540" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4428" class="Bound">M†</a>
</pre><p>The language in Chapter <a href="../More/">More</a> has more constructs, which we could easily add. However, leaving the simulation small lets us focus on the essence. It’s a handy technical trick that we can have a large source language, but only bother to include in the simulation the terms of interest.</p><h4 id="exercise-_-practice">Exercise <code>_†</code> (practice)</h4><p>Formalise the translation from source to target given in the introduction. Show that <code>M † ≡ N</code> implies <code>M ~ N</code>, and conversely.</p><p><strong>Hint:</strong> For simplicity, we focus on only a few constructs of the language, so <code>_†</code> should be defined only on relevant terms. One way to do this is to use a decidable predicate to pick out terms in the domain of <code>_†</code>, using <a href="../Decidable/#proof-by-reflection">proof by reflection</a>.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-5292" class="Comment">-- Your code goes here</a>
</pre><h2 id="simulation-commutes-with-values">Simulation commutes with values</h2>We need a number of technical results. The first is that simulation commutes with values. That is, if <code>M ~ M†</code> and <code>M</code> is a value then <code>M†</code> is also a value:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~val"></a><a id="plfa_plfa-part2-Bisimulation-5523" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5528" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5530" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-5532" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5533" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5533" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5535" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5535" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5536" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-5538" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-5539" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5539" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5541" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5541" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-5544" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-5546" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5533" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-5548" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-5550" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5535" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-5551" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-5555" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5557" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5539" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-5559" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-5561" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5541" class="Bound">M†</a>
  <a id="plfa_plfa-part2-Bisimulation-5566" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5568" href="../More/#plfa_plfa-part2-More-19171" class="Datatype">Value</a> <a id="plfa_plfa-part2-Bisimulation-5574" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5539" class="Bound">M</a>
    <a id="plfa_plfa-part2-Bisimulation-5580" class="Comment">--------</a>
  <a id="plfa_plfa-part2-Bisimulation-5591" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-5593" href="../More/#plfa_plfa-part2-More-19171" class="Datatype">Value</a> <a id="plfa_plfa-part2-Bisimulation-5599" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5541" class="Bound">M†</a>
<a id="plfa_plfa-part2-Bisimulation-5602" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5607" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a>           <a id="plfa_plfa-part2-Bisimulation-5620" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-5623" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5628" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5629" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-5632" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5632" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-5634" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-5641" href="../More/#plfa_plfa-part2-More-19226" class="InductiveConstructor">V-ƛ</a>  <a id="plfa_plfa-part2-Bisimulation-5646" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-5649" href="../More/#plfa_plfa-part2-More-19226" class="InductiveConstructor">V-ƛ</a>
<a id="plfa_plfa-part2-Bisimulation-5653" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5658" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5659" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5659" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-5662" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-5665" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5665" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-5667" class="Symbol">)</a>   <a id="plfa_plfa-part2-Bisimulation-5671" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-5674" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-5679" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-5680" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-5685" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5685" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-5688" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5688" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-5690" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-5692" class="Symbol">()</a>
</pre><p>It is a straightforward case analysis, where here the only value of interest is a lambda abstraction.</p><h4 id="exercise-val¹-practice">Exercise <code>~val⁻¹</code> (practice)</h4><p>Show that this also holds in the reverse direction: if <code>M ~ M†</code> and <code>Value M†</code> then <code>Value M</code>.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-5941" class="Comment">-- Your code goes here</a>
</pre><h2 id="simulation-commutes-with-renaming">Simulation commutes with renaming</h2><p>The next technical result is that simulation commutes with renaming. That is, if <code>ρ</code> maps any judgment <code>Γ ∋ A</code> to a judgment <code>Δ ∋ A</code>, and if <code>M ~ M†</code> then <code>rename ρ M ~ rename ρ M†</code>:</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~rename"></a><a id="plfa_plfa-part2-Bisimulation-6200" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6208" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-6210" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-6212" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6213" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6213" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-6215" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6215" class="Bound">Δ</a><a id="plfa_plfa-part2-Bisimulation-6216" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-6220" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6222" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6223" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6223" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6225" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-6227" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-6229" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6230" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6230" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-6231" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-6233" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6235" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6213" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-6237" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-6239" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6230" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-6241" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6243" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6215" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-6245" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-6247" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6230" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-6248" class="Symbol">)</a>
    <a id="plfa_plfa-part2-Bisimulation-6254" class="Comment">----------------------------------------------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-6315" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6317" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-6320" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6321" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6321" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-6322" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-6324" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-6325" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6325" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-6327" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6327" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-6330" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-6332" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6213" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-6334" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-6336" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6321" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-6337" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-6339" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6341" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6325" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-6343" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-6345" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6327" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-6348" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-6350" href="../More/#plfa_plfa-part2-More-16887" class="Function">rename</a> <a id="plfa_plfa-part2-Bisimulation-6357" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6223" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6359" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6325" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-6361" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-6363" href="../More/#plfa_plfa-part2-More-16887" class="Function">rename</a> <a id="plfa_plfa-part2-Bisimulation-6370" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6223" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6372" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6327" class="Bound">M†</a><a id="plfa_plfa-part2-Bisimulation-6374" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-6376" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6384" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6384" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6386" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6387" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a><a id="plfa_plfa-part2-Bisimulation-6389" class="Symbol">)</a>          <a id="plfa_plfa-part2-Bisimulation-6400" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6403" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a>
<a id="plfa_plfa-part2-Bisimulation-6406" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6414" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6414" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6416" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6417" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-6420" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6420" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6422" class="Symbol">)</a>       <a id="plfa_plfa-part2-Bisimulation-6430" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6433" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-6436" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6437" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6445" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6446" href="../More/#plfa_plfa-part2-More-16716" class="Function">ext</a> <a id="plfa_plfa-part2-Bisimulation-6450" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6414" class="Bound">ρ</a><a id="plfa_plfa-part2-Bisimulation-6451" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6453" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6420" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6455" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-6457" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6465" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6465" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6467" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6468" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6468" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-6471" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-6474" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6474" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-6476" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-6481" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6484" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6485" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6493" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6465" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6495" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6468" class="Bound">~L</a><a id="plfa_plfa-part2-Bisimulation-6497" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6499" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-6502" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6503" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6511" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6465" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6513" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6474" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-6515" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-6517" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6525" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6525" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6527" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6528" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-6533" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6533" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-6536" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6536" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6538" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-6541" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-6544" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-6549" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6550" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6558" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6525" class="Bound">ρ</a> <a id="plfa_plfa-part2-Bisimulation-6560" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6533" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-6562" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6564" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6565" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-6573" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-6574" href="../More/#plfa_plfa-part2-More-16716" class="Function">ext</a> <a id="plfa_plfa-part2-Bisimulation-6578" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6525" class="Bound">ρ</a><a id="plfa_plfa-part2-Bisimulation-6579" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-6581" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6536" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-6583" class="Symbol">)</a>
</pre><p>The structure of the proof is similar to the structure of renaming itself: reconstruct each term with recursive invocation, extending the environment where appropriate (in this case, only for the body of an abstraction).</p><h2 id="simulation-commutes-with-substitution">Simulation commutes with substitution</h2><p>The third technical result is that simulation commutes with substitution. It is more complex than renaming, because where we had one renaming map <code>ρ</code> here we need two substitution maps, <code>σ</code> and <code>σ†</code>.</p>The proof first requires we establish an analogue of extension. If <code>σ</code> and <code>σ†</code> both map any judgment <code>Γ ∋ A</code> to a judgment <code>Δ ⊢ A</code>, such that for every <code>x</code> in <code>Γ ∋ A</code> we have <code>σ x ~ σ† x</code>, then for any <code>x</code> in <code>Γ , B ∋ A</code> we have <code>exts σ x ~ exts σ† x</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~exts"></a><a id="plfa_plfa-part2-Bisimulation-7317" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7317" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-7323" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7325" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7327" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7328" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7328" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7330" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7330" class="Bound">Δ</a><a id="plfa_plfa-part2-Bisimulation-7331" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7335" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7337" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7338" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7338" class="Bound">σ</a>  <a id="plfa_plfa-part2-Bisimulation-7341" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7343" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7345" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7346" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7346" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7347" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7349" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7351" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7328" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7353" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7355" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7346" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7357" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7359" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7330" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-7361" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-7363" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7346" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7364" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7368" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7370" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7371" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7371" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7374" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7376" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-7378" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7379" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7379" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7380" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7382" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7384" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7328" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7386" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7388" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7379" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7390" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7392" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7330" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-7394" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-7396" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7379" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7397" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-7401" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7403" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-7406" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7407" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7407" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7408" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7410" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7412" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7413" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7413" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7415" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7417" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7328" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7419" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7421" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7407" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7422" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-7424" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7426" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7338" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-7428" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7413" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7430" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7432" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7371" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7435" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7413" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7436" class="Symbol">)</a>
    <a id="plfa_plfa-part2-Bisimulation-7442" class="Comment">--------------------------------------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-7495" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7497" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-7500" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-7501" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7501" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-7503" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7503" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-7504" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-7506" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7508" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7509" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7509" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7511" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-7513" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7328" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-7515" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-7517" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7503" class="Bound">B</a> <a id="plfa_plfa-part2-Bisimulation-7519" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-7521" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7501" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-7522" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-7524" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-7526" href="../More/#plfa_plfa-part2-More-17742" class="Function">exts</a> <a id="plfa_plfa-part2-Bisimulation-7531" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7338" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-7533" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7509" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-7535" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-7537" href="../More/#plfa_plfa-part2-More-17742" class="Function">exts</a> <a id="plfa_plfa-part2-Bisimulation-7542" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7371" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-7545" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7509" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7546" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-7548" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7317" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-7554" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7554" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7557" href="../More/#plfa_plfa-part2-More-14791" class="InductiveConstructor">Z</a>      <a id="plfa_plfa-part2-Bisimulation-7564" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-7567" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a>
<a id="plfa_plfa-part2-Bisimulation-7570" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7317" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-7576" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7576" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7579" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7580" href="../More/#plfa_plfa-part2-More-14838" class="InductiveConstructor Operator">S</a> <a id="plfa_plfa-part2-Bisimulation-7582" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7582" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7583" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-7586" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-7589" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-6200" class="Function">~rename</a> <a id="plfa_plfa-part2-Bisimulation-7597" href="../More/#plfa_plfa-part2-More-14838" class="InductiveConstructor Operator">S_</a> <a id="plfa_plfa-part2-Bisimulation-7600" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-7601" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7576" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-7604" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7582" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-7605" class="Symbol">)</a>
</pre><p>The structure of the proof is similar to the structure of extension itself. The newly introduced variable trivially relates to itself, and otherwise we apply renaming to the hypothesis.</p>With extension under our belts, it is straightforward to show substitution commutes. If <code>σ</code> and <code>σ†</code> both map any judgment <code>Γ ∋ A</code> to a judgment <code>Δ ⊢ A</code>, such that for every <code>x</code> in <code>Γ ∋ A</code> we have <code>σ x ~ σ† x</code>, and if <code>M ~ M†</code>, then <code>subst σ M ~ subst σ† M†</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~subst"></a><a id="plfa_plfa-part2-Bisimulation-8067" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8074" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8076" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-8078" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8079" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8079" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8081" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8081" class="Bound">Δ</a><a id="plfa_plfa-part2-Bisimulation-8082" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-8086" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8088" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8089" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8089" class="Bound">σ</a>  <a id="plfa_plfa-part2-Bisimulation-8092" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8094" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-8096" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8097" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8097" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8098" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8100" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8102" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8079" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8104" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-8106" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8097" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-8108" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8110" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8081" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-8112" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8114" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8097" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8115" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-8119" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8121" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8122" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8122" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-8125" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8127" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-8129" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8130" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8130" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8131" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8133" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8135" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8079" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8137" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-8139" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8130" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-8141" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8143" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8081" class="Bound">Δ</a> <a id="plfa_plfa-part2-Bisimulation-8145" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8147" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8130" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8148" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-8152" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8154" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-8157" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8158" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8158" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8159" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8161" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8163" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8164" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8164" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-8166" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8168" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8079" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8170" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-8172" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8158" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8173" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8175" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8177" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8089" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-8179" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8164" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-8181" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8183" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8122" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-8186" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8164" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-8187" class="Symbol">)</a>
    <a id="plfa_plfa-part2-Bisimulation-8193" class="Comment">---------------------------------------------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-8253" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8255" class="Symbol">(∀</a> <a id="plfa_plfa-part2-Bisimulation-8258" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8259" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8259" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8260" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8262" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8263" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8263" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8265" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8265" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-8268" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8270" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8079" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8272" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8274" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8259" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8275" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8277" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8279" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8263" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8281" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8283" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8265" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-8286" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8288" href="../More/#plfa_plfa-part2-More-17874" class="Function">subst</a> <a id="plfa_plfa-part2-Bisimulation-8294" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8089" class="Bound">σ</a> <a id="plfa_plfa-part2-Bisimulation-8296" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8263" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8298" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8300" href="../More/#plfa_plfa-part2-More-17874" class="Function">subst</a> <a id="plfa_plfa-part2-Bisimulation-8306" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8122" class="Bound">σ†</a> <a id="plfa_plfa-part2-Bisimulation-8309" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8265" class="Bound">M†</a><a id="plfa_plfa-part2-Bisimulation-8311" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-8313" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8320" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8320" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8323" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8324" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a> <a id="plfa_plfa-part2-Bisimulation-8327" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8328" class="Argument">x</a> <a id="plfa_plfa-part2-Bisimulation-8330" class="Symbol">=</a> <a id="plfa_plfa-part2-Bisimulation-8332" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8332" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-8333" class="Symbol">})</a>  <a id="plfa_plfa-part2-Bisimulation-8337" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8340" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8320" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8343" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8332" class="Bound">x</a>
<a id="plfa_plfa-part2-Bisimulation-8345" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8352" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8352" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8355" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8356" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-8359" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8359" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8361" class="Symbol">)</a>       <a id="plfa_plfa-part2-Bisimulation-8369" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8372" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-8375" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8376" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8383" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8384" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7317" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-8390" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8352" class="Bound">~σ</a><a id="plfa_plfa-part2-Bisimulation-8392" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8394" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8359" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8396" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-8398" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8405" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8405" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8408" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8409" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8409" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-8412" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-8415" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8415" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-8417" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-8422" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8425" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8426" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8433" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8405" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8436" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8409" class="Bound">~L</a><a id="plfa_plfa-part2-Bisimulation-8438" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8440" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-8443" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8444" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8451" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8405" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8454" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8415" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-8456" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-8458" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8465" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8465" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8468" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8469" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-8474" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8474" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-8477" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8477" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8479" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-8482" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-8485" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-8490" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8491" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8498" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8465" class="Bound">~σ</a> <a id="plfa_plfa-part2-Bisimulation-8501" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8474" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-8503" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8505" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8506" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-8513" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-8514" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-7317" class="Function">~exts</a> <a id="plfa_plfa-part2-Bisimulation-8520" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8465" class="Bound">~σ</a><a id="plfa_plfa-part2-Bisimulation-8522" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-8524" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8477" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-8526" class="Symbol">)</a>
</pre><p>Again, the structure of the proof is similar to the structure of substitution itself: reconstruct each term with recursive invocation, extending the environment where appropriate (in this case, only for the body of an abstraction).</p>From the general case of substitution, it is also easy to derive the required special case. If <code>N ~ N†</code> and <code>M ~ M†</code>, then <code>N [ M ] ~ N† [ M† ]</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-~sub"></a><a id="plfa_plfa-part2-Bisimulation-8920" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8920" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-8925" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8927" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-8929" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8930" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8930" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8932" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8932" class="Bound">A</a> <a id="plfa_plfa-part2-Bisimulation-8934" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8934" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-8935" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8937" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8938" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8938" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-8940" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8940" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-8943" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8945" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8930" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8947" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-8949" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8934" class="Bound">B</a> <a id="plfa_plfa-part2-Bisimulation-8951" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8953" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8932" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-8954" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-8956" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-8957" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8957" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8959" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8959" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-8962" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-8964" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8930" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-8966" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-8968" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8934" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-8969" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-8973" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8975" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8938" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-8977" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8979" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8940" class="Bound">N†</a>
  <a id="plfa_plfa-part2-Bisimulation-8984" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-8986" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8957" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-8988" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-8990" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8959" class="Bound">M†</a>
    <a id="plfa_plfa-part2-Bisimulation-8997" class="Comment">-----------------------</a>
  <a id="plfa_plfa-part2-Bisimulation-9023" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9025" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9026" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8938" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-9028" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">[</a> <a id="plfa_plfa-part2-Bisimulation-9030" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8957" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-9032" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">]</a><a id="plfa_plfa-part2-Bisimulation-9033" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-9035" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-9037" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9038" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8940" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-9041" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">[</a> <a id="plfa_plfa-part2-Bisimulation-9043" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8959" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9046" href="../More/#plfa_plfa-part2-More-18773" class="Function Operator">]</a><a id="plfa_plfa-part2-Bisimulation-9047" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-9049" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8920" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-9054" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9055" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9055" class="Bound">Γ</a><a id="plfa_plfa-part2-Bisimulation-9056" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9058" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9059" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9059" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9060" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9062" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9063" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9063" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-9064" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9066" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9066" class="Bound">~N</a> <a id="plfa_plfa-part2-Bisimulation-9069" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9069" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-9072" class="Symbol">=</a> <a id="plfa_plfa-part2-Bisimulation-9074" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8067" class="Function">~subst</a> <a id="plfa_plfa-part2-Bisimulation-9081" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9082" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9055" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9084" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-9086" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9063" class="Bound">B</a><a id="plfa_plfa-part2-Bisimulation-9087" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9089" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9090" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9055" class="Bound">Γ</a><a id="plfa_plfa-part2-Bisimulation-9091" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9093" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9113" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-9096" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9097" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9059" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9098" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9100" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9066" class="Bound">~N</a>
  <a id="plfa_plfa-part2-Bisimulation-9105" class="Keyword">where</a>
  <a id="plfa_plfa-part2-Bisimulation-9113" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9113" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-9116" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9118" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-9120" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9121" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9121" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9122" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9124" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9126" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9127" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9127" class="Bound">x</a> <a id="plfa_plfa-part2-Bisimulation-9129" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9131" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9055" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9133" href="../More/#plfa_plfa-part2-More-14667" class="InductiveConstructor Operator">,</a> <a id="plfa_plfa-part2-Bisimulation-9135" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9063" class="Bound">B</a> <a id="plfa_plfa-part2-Bisimulation-9137" href="../More/#plfa_plfa-part2-More-14755" class="Datatype Operator">∋</a> <a id="plfa_plfa-part2-Bisimulation-9139" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9121" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9140" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-9142" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9144" class="Symbol">_</a> <a id="plfa_plfa-part2-Bisimulation-9146" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-9148" class="Symbol">_</a>
  <a id="plfa_plfa-part2-Bisimulation-9152" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9113" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-9155" href="../More/#plfa_plfa-part2-More-14791" class="InductiveConstructor">Z</a>      <a id="plfa_plfa-part2-Bisimulation-9162" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-9165" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9069" class="Bound">~M</a>
  <a id="plfa_plfa-part2-Bisimulation-9170" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9113" class="Function">~σ</a> <a id="plfa_plfa-part2-Bisimulation-9173" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9174" href="../More/#plfa_plfa-part2-More-14838" class="InductiveConstructor Operator">S</a> <a id="plfa_plfa-part2-Bisimulation-9176" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9176" class="Bound">x</a><a id="plfa_plfa-part2-Bisimulation-9177" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-9180" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-9183" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a>
</pre><p>Once more, the structure of the proof resembles the original.</p><h2 id="the-relation-is-a-simulation">The relation is a simulation</h2><p>Finally, we can show that the relation actually is a simulation. In fact, we will show the stronger condition of a lock-step simulation. What we wish to show is:</p><p><em>Lock-step simulation</em>: For every <code>M</code>, <code>M†</code>, and <code>N</code>: If <code>M ~ M†</code> and <code>M —→ N</code> then <code>M† —→ N†</code> and <code>N ~ N†</code> for some <code>N†</code>.</p><p>Or, in a diagram:</p><pre><code>M  --- —→ --- N
|             |
|             |
~             ~
|             |
|             |
M† --- —→ --- N†</code></pre>We first formulate a concept corresponding to the lower leg of the diagram, that is, its right and bottom edges:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-9856" class="Keyword">data</a> <a id="plfa_plfa-part2-Bisimulation-Leg"></a><a id="plfa_plfa-part2-Bisimulation-9861" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9861" class="Datatype">Leg</a> <a id="plfa_plfa-part2-Bisimulation-9865" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9866" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9866" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9868" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9868" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9869" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-9871" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-9872" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9872" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9875" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9875" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-9877" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9879" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9866" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9881" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-9883" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9868" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9884" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-9886" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9888" href="https://agda.github.io/agda-stdlib/v1.7.1/Agda.Primitive.html#326" class="Primitive">Set</a> <a id="plfa_plfa-part2-Bisimulation-9892" class="Keyword">where</a>

  <a id="plfa_plfa-part2-Bisimulation-Leg.leg"></a><a id="plfa_plfa-part2-Bisimulation-9901" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-9905" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9907" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-9909" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-9910" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9910" class="Bound">N†</a> <a id="plfa_plfa-part2-Bisimulation-9913" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-9915" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9866" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-9917" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-9919" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9868" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-9920" class="Symbol">}</a>
    <a id="plfa_plfa-part2-Bisimulation-9926" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9928" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9875" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-9930" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-9932" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9910" class="Bound">N†</a>
    <a id="plfa_plfa-part2-Bisimulation-9939" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9941" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9872" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9944" href="../More/#plfa_plfa-part2-More-19832" class="Datatype Operator">—→</a> <a id="plfa_plfa-part2-Bisimulation-9947" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9910" class="Bound">N†</a>
      <a id="plfa_plfa-part2-Bisimulation-9956" class="Comment">--------</a>
    <a id="plfa_plfa-part2-Bisimulation-9969" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-9971" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9861" class="Datatype">Leg</a> <a id="plfa_plfa-part2-Bisimulation-9975" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9872" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-9978" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9875" class="Bound">N</a>
</pre><p>For our formalisation, in this case, we can use a stronger relation than <code>—↠</code>, replacing it by <code>—→</code>.</p>We can now state and prove that the relation is a simulation. Again, in this case, we can use a stronger relation than <code>—↠</code>, replacing it by <code>—→</code>:<pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-sim"></a><a id="plfa_plfa-part2-Bisimulation-10241" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10245" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-10247" class="Symbol">∀</a> <a id="plfa_plfa-part2-Bisimulation-10249" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-10250" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10250" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-10252" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10252" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-10253" class="Symbol">}</a> <a id="plfa_plfa-part2-Bisimulation-10255" class="Symbol">{</a><a id="plfa_plfa-part2-Bisimulation-10256" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10256" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-10258" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10258" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-10261" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10261" class="Bound">N</a> <a id="plfa_plfa-part2-Bisimulation-10263" class="Symbol">:</a> <a id="plfa_plfa-part2-Bisimulation-10265" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10250" class="Bound">Γ</a> <a id="plfa_plfa-part2-Bisimulation-10267" href="../More/#plfa_plfa-part2-More-14950" class="Datatype Operator">⊢</a> <a id="plfa_plfa-part2-Bisimulation-10269" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10252" class="Bound">A</a><a id="plfa_plfa-part2-Bisimulation-10270" class="Symbol">}</a>
  <a id="plfa_plfa-part2-Bisimulation-10274" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-10276" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10256" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-10278" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4092" class="Datatype Operator">~</a> <a id="plfa_plfa-part2-Bisimulation-10280" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10258" class="Bound">M†</a>
  <a id="plfa_plfa-part2-Bisimulation-10285" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-10287" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10256" class="Bound">M</a> <a id="plfa_plfa-part2-Bisimulation-10289" href="../More/#plfa_plfa-part2-More-19832" class="Datatype Operator">—→</a> <a id="plfa_plfa-part2-Bisimulation-10292" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10261" class="Bound">N</a>
    <a id="plfa_plfa-part2-Bisimulation-10298" class="Comment">---------</a>
  <a id="plfa_plfa-part2-Bisimulation-10310" class="Symbol">→</a> <a id="plfa_plfa-part2-Bisimulation-10312" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9861" class="Datatype">Leg</a>  <a id="plfa_plfa-part2-Bisimulation-10317" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10258" class="Bound">M†</a> <a id="plfa_plfa-part2-Bisimulation-10320" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10261" class="Bound">N</a>
<a id="plfa_plfa-part2-Bisimulation-10322" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10326" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4141" class="InductiveConstructor">~`</a>              <a id="plfa_plfa-part2-Bisimulation-10342" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-10345" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10349" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10350" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10353" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10353" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10355" class="Symbol">)</a>         <a id="plfa_plfa-part2-Bisimulation-10365" class="Symbol">()</a>
<a id="plfa_plfa-part2-Bisimulation-10368" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10372" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10373" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10373" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-10376" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10379" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10379" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-10381" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-10388" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10389" href="../More/#plfa_plfa-part2-More-19898" class="InductiveConstructor">ξ-·₁</a> <a id="plfa_plfa-part2-Bisimulation-10394" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10394" class="Bound">L—→</a><a id="plfa_plfa-part2-Bisimulation-10397" class="Symbol">)</a>
  <a id="plfa_plfa-part2-Bisimulation-10401" class="Keyword">with</a> <a id="plfa_plfa-part2-Bisimulation-10406" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10410" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10373" class="Bound">~L</a> <a id="plfa_plfa-part2-Bisimulation-10413" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10394" class="Bound">L—→</a>
<a id="plfa_plfa-part2-Bisimulation-10417" class="Symbol">...</a>  <a id="plfa_plfa-part2-Bisimulation-10422" class="Symbol">|</a> <a id="plfa_plfa-part2-Bisimulation-10424" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10428" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10428" class="Bound">~L′</a> <a id="plfa_plfa-part2-Bisimulation-10432" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10432" class="Bound">L†—→</a>                 <a id="plfa_plfa-part2-Bisimulation-10453" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10456" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10460" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10461" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10428" class="Bound">~L′</a> <a id="plfa_plfa-part2-Bisimulation-10465" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10468" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-10470" class="Symbol">)</a>   <a id="plfa_plfa-part2-Bisimulation-10474" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10475" href="../More/#plfa_plfa-part2-More-19898" class="InductiveConstructor">ξ-·₁</a> <a id="plfa_plfa-part2-Bisimulation-10480" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10432" class="Bound">L†—→</a><a id="plfa_plfa-part2-Bisimulation-10484" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-10486" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10490" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10491" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10491" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10494" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10497" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10497" class="Bound">~M</a><a id="plfa_plfa-part2-Bisimulation-10499" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-10506" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10507" href="../More/#plfa_plfa-part2-More-20007" class="InductiveConstructor">ξ-·₂</a> <a id="plfa_plfa-part2-Bisimulation-10512" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10512" class="Bound">VV</a> <a id="plfa_plfa-part2-Bisimulation-10515" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10515" class="Bound">M—→</a><a id="plfa_plfa-part2-Bisimulation-10518" class="Symbol">)</a>
  <a id="plfa_plfa-part2-Bisimulation-10522" class="Keyword">with</a> <a id="plfa_plfa-part2-Bisimulation-10527" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10531" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10497" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-10534" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10515" class="Bound">M—→</a>
<a id="plfa_plfa-part2-Bisimulation-10538" class="Symbol">...</a>  <a id="plfa_plfa-part2-Bisimulation-10543" class="Symbol">|</a> <a id="plfa_plfa-part2-Bisimulation-10545" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10549" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10549" class="Bound">~M′</a> <a id="plfa_plfa-part2-Bisimulation-10553" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10553" class="Bound">M†—→</a>                 <a id="plfa_plfa-part2-Bisimulation-10574" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10577" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10581" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10582" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10585" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10588" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10549" class="Bound">~M′</a><a id="plfa_plfa-part2-Bisimulation-10591" class="Symbol">)</a>   <a id="plfa_plfa-part2-Bisimulation-10595" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10596" href="../More/#plfa_plfa-part2-More-20007" class="InductiveConstructor">ξ-·₂</a> <a id="plfa_plfa-part2-Bisimulation-10601" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10602" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-10607" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10610" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10612" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10614" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10553" class="Bound">M†—→</a><a id="plfa_plfa-part2-Bisimulation-10618" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-10620" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10624" class="Symbol">((</a><a id="plfa_plfa-part2-Bisimulation-10626" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4199" class="InductiveConstructor Operator">~ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10629" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10629" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10631" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10633" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4284" class="InductiveConstructor Operator">~·</a> <a id="plfa_plfa-part2-Bisimulation-10636" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10636" class="Bound">~V</a><a id="plfa_plfa-part2-Bisimulation-10638" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10640" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10641" href="../More/#plfa_plfa-part2-More-20130" class="InductiveConstructor">β-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10645" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10645" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10647" class="Symbol">)</a>        <a id="plfa_plfa-part2-Bisimulation-10656" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10659" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10663" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10664" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8920" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-10669" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10629" class="Bound">~N</a> <a id="plfa_plfa-part2-Bisimulation-10672" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10636" class="Bound">~V</a><a id="plfa_plfa-part2-Bisimulation-10674" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-10677" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10678" href="../More/#plfa_plfa-part2-More-20130" class="InductiveConstructor">β-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10682" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10683" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-10688" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10636" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10691" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10645" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10693" class="Symbol">))</a>
<a id="plfa_plfa-part2-Bisimulation-10696" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10700" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10701" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-10706" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10706" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-10709" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10709" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10711" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-10716" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10717" href="../More/#plfa_plfa-part2-More-21180" class="InductiveConstructor">ξ-let</a> <a id="plfa_plfa-part2-Bisimulation-10723" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10723" class="Bound">M—→</a><a id="plfa_plfa-part2-Bisimulation-10726" class="Symbol">)</a>
  <a id="plfa_plfa-part2-Bisimulation-10730" class="Keyword">with</a> <a id="plfa_plfa-part2-Bisimulation-10735" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10739" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10706" class="Bound">~M</a> <a id="plfa_plfa-part2-Bisimulation-10742" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10723" class="Bound">M—→</a>
<a id="plfa_plfa-part2-Bisimulation-10746" class="Symbol">...</a>  <a id="plfa_plfa-part2-Bisimulation-10751" class="Symbol">|</a> <a id="plfa_plfa-part2-Bisimulation-10753" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10757" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10757" class="Bound">~M′</a> <a id="plfa_plfa-part2-Bisimulation-10761" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10761" class="Bound">M†—→</a>                 <a id="plfa_plfa-part2-Bisimulation-10782" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10785" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10789" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10790" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-10795" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10757" class="Bound">~M′</a> <a id="plfa_plfa-part2-Bisimulation-10799" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10801" class="Symbol">)</a> <a id="plfa_plfa-part2-Bisimulation-10803" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10804" href="../More/#plfa_plfa-part2-More-20007" class="InductiveConstructor">ξ-·₂</a> <a id="plfa_plfa-part2-Bisimulation-10809" href="../More/#plfa_plfa-part2-More-19226" class="InductiveConstructor">V-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10813" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10761" class="Bound">M†—→</a><a id="plfa_plfa-part2-Bisimulation-10817" class="Symbol">)</a>
<a id="plfa_plfa-part2-Bisimulation-10819" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10241" class="Function">sim</a> <a id="plfa_plfa-part2-Bisimulation-10823" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10824" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-4408" class="InductiveConstructor">~let</a> <a id="plfa_plfa-part2-Bisimulation-10829" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10829" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10832" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10832" class="Bound">~N</a><a id="plfa_plfa-part2-Bisimulation-10834" class="Symbol">)</a>    <a id="plfa_plfa-part2-Bisimulation-10839" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10840" href="../More/#plfa_plfa-part2-More-21302" class="InductiveConstructor">β-let</a> <a id="plfa_plfa-part2-Bisimulation-10846" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10846" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10848" class="Symbol">)</a>      <a id="plfa_plfa-part2-Bisimulation-10855" class="Symbol">=</a>  <a id="plfa_plfa-part2-Bisimulation-10858" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-9901" class="InductiveConstructor">leg</a> <a id="plfa_plfa-part2-Bisimulation-10862" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10863" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-8920" class="Function">~sub</a> <a id="plfa_plfa-part2-Bisimulation-10868" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10832" class="Bound">~N</a> <a id="plfa_plfa-part2-Bisimulation-10871" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10829" class="Bound">~V</a><a id="plfa_plfa-part2-Bisimulation-10873" class="Symbol">)</a>  <a id="plfa_plfa-part2-Bisimulation-10876" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10877" href="../More/#plfa_plfa-part2-More-20130" class="InductiveConstructor">β-ƛ</a> <a id="plfa_plfa-part2-Bisimulation-10881" class="Symbol">(</a><a id="plfa_plfa-part2-Bisimulation-10882" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-5523" class="Function">~val</a> <a id="plfa_plfa-part2-Bisimulation-10887" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10829" class="Bound">~V</a> <a id="plfa_plfa-part2-Bisimulation-10890" href="../Bisimulation/#plfa_plfa-part2-Bisimulation-10846" class="Bound">VV</a><a id="plfa_plfa-part2-Bisimulation-10892" class="Symbol">))</a>
</pre><p>The proof is by case analysis, examining each possible instance of <code>M ~ M†</code> and each possible instance of <code>M —→ M†</code>, using recursive invocation whenever the reduction is by a <code>ξ</code> rule, and hence contains another reduction. In its structure, it looks a little bit like a proof of progress:</p><ul><li><p>If the related terms are variables, no reduction applies.</p></li><li><p>If the related terms are abstractions, no reduction applies.</p></li><li><p>If the related terms are applications, there are three subcases:</p><ul><li><p>The source term reduces via <code>ξ-·₁</code>, in which case the target term does as well. Recursive invocation gives us</p><pre><code>L  --- —→ ---  L′
|              |
|              |
~              ~
|              |
|              |
L† --- —→ --- L′†</code></pre><p>from which follows:</p><pre><code> L · M  --- —→ ---  L′ · M
   |                   |
   |                   |
   ~                   ~
   |                   |
   |                   |
L† · M† --- —→ --- L′† · M†</code></pre></li><li><p>The source term reduces via <code>ξ-·₂</code>, in which case the target term does as well. Recursive invocation gives us</p><pre><code>M  --- —→ ---  M′
|              |
|              |
~              ~
|              |
|              |
M† --- —→ --- M′†</code></pre><p>from which follows:</p><pre><code> V · M  --- —→ ---  V · M′
   |                  |
   |                  |
   ~                  ~
   |                  |
   |                  |
V† · M† --- —→ --- V† · M′†</code></pre><p>Since simulation commutes with values and <code>V</code> is a value, <code>V†</code> is also a value.</p></li><li><p>The source term reduces via <code>β-ƛ</code>, in which case the target term does as well:</p><pre><code> (ƛ x ⇒ N) · V  --- —→ ---  N [ x := V ]
      |                           |
      |                           |
      ~                           ~
      |                           |
      |                           |
(ƛ x ⇒ N†) · V† --- —→ --- N† [ x :=  V† ]</code></pre><p>Since simulation commutes with values and <code>V</code> is a value, <code>V†</code> is also a value. Since simulation commutes with substitution and <code>N ~ N†</code> and <code>V ~ V†</code>, we have <code>N [ x := V ] ~ N† [ x := V† ]</code>.</p></li></ul></li><li><p>If the related terms are a let and an application of an abstraction, there are two subcases:</p><ul><li><p>The source term reduces via <code>ξ-let</code>, in which case the target term reduces via <code>ξ-·₂</code>. Recursive invocation gives us</p><pre><code>M  --- —→ ---  M′
|              |
|              |
~              ~
|              |
|              |
M† --- —→ --- M′†</code></pre><p>from which follows:</p><pre><code>let x = M in N --- —→ --- let x = M′ in N
      |                         |
      |                         |
      ~                         ~
      |                         |
      |                         |
(ƛ x ⇒ N) · M  --- —→ --- (ƛ x ⇒ N) · M′</code></pre></li><li><p>The source term reduces via <code>β-let</code>, in which case the target term reduces via <code>β-ƛ</code>:</p><pre><code>let x = V in N  --- —→ ---  N [ x := V ]
      |                         |
      |                         |
      ~                         ~
      |                         |
      |                         |
(ƛ x ⇒ N†) · V† --- —→ --- N† [ x := V† ]</code></pre><p>Since simulation commutes with values and <code>V</code> is a value, <code>V†</code> is also a value. Since simulation commutes with substitution and <code>N ~ N†</code> and <code>V ~ V†</code>, we have <code>N [ x := V ] ~ N† [ x := V† ]</code>.</p></li></ul></li></ul><h4 id="exercise-sim¹-practice">Exercise <code>sim⁻¹</code> (practice)</h4><p>Show that we also have a simulation in the other direction, and hence that we have a bisimulation.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-14678" class="Comment">-- Your code goes here</a>
</pre><h4 id="exercise-products-practice">Exercise <code>products</code> (practice)</h4><p>Show that the two formulations of products in Chapter <a href="../More/">More</a> are in bisimulation. The only constructs you need to include are variables, and those connected to functions and products. In this case, the simulation is <em>not</em> lock-step.</p><pre class="Agda"><a id="plfa_plfa-part2-Bisimulation-14994" class="Comment">-- Your code goes here</a>
</pre><h2 id="unicode">Unicode</h2><p>This chapter uses the following unicode:</p><pre><code>†  U+2020  DAGGER (\dag)
⁻  U+207B  SUPERSCRIPT MINUS (\^-)
¹  U+00B9  SUPERSCRIPT ONE (\^1)</code></pre></div><nav class="pager"><ul class="pagination"><li><a class="pagelink" href="../More/">Prev</a></li><li class="separator">•</li><li><a class="pagelink" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/part2/Bisimulation.lagda.md">Source</a></li><li class="separator">•</li><li><a class="pagelink" href="../Inference/">Next</a></li><li class="separator">•</li></ul></nav></article></div></main><footer class="site-footer h-card"><data class="u-url" href="../"></data><div class="wrapper"><h2 class="footer-heading">Programming Language Foundations in Agda</h2><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Philip Wadler</li><li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk"><i class="far fa-envelope"></i>  wadler@inf.ed.ac.uk</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://github.com/wadler" title="wadler"><i class="fab fa-github"></i>  wadler</a></li></ul></div><div class="footer-col footer-col-3"></div></div><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Wen Kokke</li><li><a class="u-email" href="mailto:me@wen.works"><i class="far fa-envelope"></i>  me@wen.works</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://github.com/wenkokke" title="wenkokke"><i class="fab fa-github"></i>  wenkokke</a></li><li><a rel="me" href="https://twitter.com/wenkokke" title="wenkokke"><i class="fab fa-twitter"></i>  wenkokke</a></li></ul></div><div class="footer-col footer-col-3"></div></div><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Jeremy G. Siek</li><li><a class="u-email" href="mailto:jsiek@indiana.edu"><i class="far fa-envelope"></i>  jsiek@indiana.edu</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://github.com/jsiek" title="jsiek"><i class="fab fa-github"></i>  jsiek</a></li><li><a rel="me" href="https://twitter.com/jeremysiek" title="jeremysiek"><i class="fab fa-twitter"></i>  jeremysiek</a></li></ul></div><div class="footer-col footer-col-3"></div></div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></div></footer></body></html>